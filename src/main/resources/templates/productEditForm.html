<form action="#"  th:object="${product}">
    <label for="name">Name</label>
    <input type="text" class="form-control" th:field="*{name}" id="name" placeholder="Name">
    <span th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></span>
    <label for="price">Price</label>
    <input type="number" class="form-control" th:field="*{price}" id="price" step=".01" placeholder="Price">
    <span th:if="${#fields.hasErrors('price')}" th:errors="*{price}"></span>
    <label for="producerId">Producer</label>
    <select th:field="*{producerId}" class="form-select" id="producerId" placeholder="producer">
        <option th:value="${product.producer.id}" th:text="${product.producer.name}"></option>
        <option th:each="producer : ${producers}" th:value="${producer.id}" th:text="${producer.name}"></option>
    </select>
    <button type="submit" name="update_data" th:attr="resource=|/products/${product.id}|" >Update product</button>
</form>


<script>

    function makeDELETErequest(urlParametr) {
        if (confirm('Are you sure you want to delete this?')) {
            $.ajax({
                url: urlParametr,
                type: 'DELETE',
                success: function () {
                    location.reload();
                }
            });
        }
    }

    var putMethod = (event) => {
        event.preventDefault();
        var button = document.querySelectorAll("[name=update_data]");
        var url = button[0].getAttribute("resource")
        var messages = document.querySelectorAll("[class=form-control]");
        var body = {};
        messages.forEach(element => {
            var name = element.getAttribute("name");
            if (element.tagName != "TEXTAREA") {
                var value = element.value;
            } else {
                // if element is textarea, value attribute may return null or undefined
                var value = element.innerHTML;
            }
            body[name] = value;
        })
        {
            var e = document.querySelectorAll("[class=form-select]")[0];
            if (typeof e !== 'undefined') {
                var name = e.getAttribute("name");
                body[name] = e.value;
            }
        }
        var xhr = new XMLHttpRequest();
        xhr.open("PUT", url);
        xhr.setRequestHeader("Content-Type", "application/json; charset=utf-8");
        xhr.onload = () => {
            if (xhr.status === 200) {
                var button = document.querySelectorAll("[name=update_data]");
                button[0].innerHTML = "Updated!"
            } else {
                console.log(xhr.status, xhr.responseText);
            }
        }
        xhr.send(JSON.stringify(body));
    };
    document.querySelectorAll("[name=update_data]").forEach(element => {
        element.addEventListener("click", putMethod);
    })
</script>