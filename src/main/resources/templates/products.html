<div th:switch="${products}">
    <h2 th:case="null">No products yet!</h2>
    <div th:case="*">
        <h2>Products</h2>
        <table>
            <thead>
            <tr>
                <th>Name</th>
                <th>Price</th>
                <th>Producer</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="product : ${products}">
                <td th:text="${product.name}"></td>
                <td th:text="${product.price}"></td>
                <td th:text="${product.producer.name}"></td>
                <td><a class="btn btn-primary" th:href="@{/products/{id}(id=${product.id})}">Edit</a></td>
                <td>
                    <button class="btn btn-primary" th:attr="onclick=|makeDELETErequest('/products/${product.id}')|">Delete
                    </button>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
    <p><a href="/products/create">Add a new product</a></p>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>


    function makeDELETErequest(urlParametr) {
        if (confirm('Are you sure you want to delete this?')) {
            $.ajax({
                url: urlParametr,
                type: 'DELETE',
                success: function () {
                    location.reload();
                }
            });
        }
    }

    var putMethod = (event) => {
        event.preventDefault();
        var button = document.querySelectorAll("[name=update_data]");
        var url = button[0].getAttribute("resource")
        var messages = document.querySelectorAll("[class=form-control]");
        var body = {};
        messages.forEach(element => {
            var name = element.getAttribute("name");
            if (element.tagName != "TEXTAREA") {
                var value = element.value;
            } else {
                // if element is textarea, value attribute may return null or undefined
                var value = element.innerHTML;
            }
            body[name] = value;
        })
        {
            var e = document.querySelectorAll("[class=form-select]")[0];
            if (typeof e !== 'undefined') {
                var name = e.getAttribute("name");
                body[name] = e.value;
            }
        }
        var xhr = new XMLHttpRequest();
        xhr.open("PUT", url);
        xhr.setRequestHeader("Content-Type", "application/json; charset=utf-8");
        xhr.onload = () => {
            if (xhr.status === 200) {
                var button = document.querySelectorAll("[name=update_data]");
                button[0].innerHTML = "Updated!"
            } else {
                console.log(xhr.status, xhr.responseText);
            }
        }
        xhr.send(JSON.stringify(body));
    };
    document.querySelectorAll("[name=update_data]").forEach(element => {
        element.addEventListener("click", putMethod);
    })
</script>